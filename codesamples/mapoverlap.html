<pre class="example"><span style='color:#800000; font-weight:bold; '>float</span> conv<span style='color:#808030; '>(</span>skepu<span style='color:#800080; '>::</span>Region2D<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> r<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>const</span> skepu<span style='color:#800080; '>::</span>Mat<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> stencil<span style='color:#808030; '>)</span>
<span style='color:#800080; '>{</span>
	<span style='color:#800000; font-weight:bold; '>float</span> res <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
	<span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span>r<span style='color:#808030; '>.</span>oi<span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> r<span style='color:#808030; '>.</span>oi<span style='color:#800080; '>;</span> <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>i<span style='color:#808030; '>)</span>
		<span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span>r<span style='color:#808030; '>.</span>oj<span style='color:#800080; '>;</span> j <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> r<span style='color:#808030; '>.</span>oj<span style='color:#800080; '>;</span> <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>j<span style='color:#808030; '>)</span>
			res <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> r<span style='color:#808030; '>(</span>i<span style='color:#808030; '>,</span> j<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> stencil<span style='color:#808030; '>(</span>i <span style='color:#808030; '>+</span> r<span style='color:#808030; '>.</span>oi<span style='color:#808030; '>,</span> j <span style='color:#808030; '>+</span> r<span style='color:#808030; '>.</span>oj<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
	<span style='color:#800000; font-weight:bold; '>return</span> res<span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>

Vector<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> convolution<span style='color:#808030; '>(</span>Vector<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> <span style='color:#808030; '>&amp;</span>v<span style='color:#808030; '>)</span>
<span style='color:#800080; '>{</span>
	<span style='color:#800000; font-weight:bold; '>auto</span> convol <span style='color:#808030; '>=</span> MapOverlap<span style='color:#808030; '>(</span>conv<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
	Vector<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> stencil <span style='color:#800080; '>{</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
	Vector<span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>float</span><span style='color:#800080; '>></span> result<span style='color:#808030; '>(</span>v<span style='color:#808030; '>.</span>size<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
	convol<span style='color:#808030; '>.</span>setOverlap<span style='color:#808030; '>(</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
	<span style='color:#800000; font-weight:bold; '>return</span> convol<span style='color:#808030; '>(</span>result<span style='color:#808030; '>,</span> v<span style='color:#808030; '>,</span> stencil<span style='color:#808030; '>,</span> <span style='color:#008c00; '>10</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
<span style='color:#800080; '>}</span>
</pre>
